# frozen_string_literal: true

class VulnerabilityBulletin < ApplicationRecord
  include OrganizationMember
  include Linkable
  include Tagable
  include Attachable
  include VulnerabilityBulletin::Ransackers
  include CustomFieldable
  include Monitorable
  include Deliverable
  include Readable
  include StripTextFields

  before_validation :set_name

  validates :name, length: { in: 3..200, allow_blank: true }
  validates :codename, length: { in: 3..200 }
  validates :codename, uniqueness: true
  #validates :organization_id, numericality: { only_integer: true }

  belongs_to :organization
  belongs_to :vulnerability_bulletin_kind

  has_many :vulnerability_bulletin_members, dependent: :delete_all
  has_many :vulnerabilities, through: :vulnerability_bulletin_members

  def allowed_delivery_lists
    DeliveryList.all - delivery_lists
  end

  private

  def set_name
    return if name.present?
    self.name = vulnerability_bulletin_kind&.name
  end

end
